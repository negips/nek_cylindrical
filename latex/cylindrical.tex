\documentclass{kthreport}

\usepackage{color}
\usepackage{natbib}
\usepackage[shortlabels]{enumitem}
\usepackage[margin=5pt,skip=0pt]{caption}
\usepackage{placeins}
\usepackage{bibentry}
\usepackage{amsmath}
\usepackage{cancel}
\usepackage{tabularx}
\usepackage{amssymb}
\usepackage{bm}			% Bold math
\usepackage{tabstackengine}
\usepackage{xcolor}
\usepackage{relsize}
%\usepackage{biblatex}
%\addbibresource{licentiate.bib}
%\DeclareBibliographyCategory{ignore}
%\addtocategory{ignore}{poirel08,poirel10,barnes16,yuan13,barnes18}

% default language is English, but you can use Swedish definitions like this:
% \documentclass[swedish]{kthreport}

% Remember that in order for the class to find the KTH logo, you need to
% have it in your path, for example:
% export TEXINPUTS=/path/to/logo/location//:$TEXINPUTS

\title{Navier--Stokes in Cylindrical formulation}
\subtitle{Weak form and Nek implementation}
\author{Prabal Negi}
%\diarienr{99999-99}
\newcommand{\ignorecite}[1]{{\@fileswfalse\cite{#1}}}
\newcommand{\ignorecitep}[1]{{\@fileswfalse\citep{#1}}}

\begin{document}
\maketitle

\section{Formulation of Navier--Stokes}

\subsection{Mapping from Cartesian to Cylindrical}

\begin{subequations}
	\begin{eqnarray}	
		x_{c}	&= & x \\
		y_{c}   &= & r\cos(\theta)\\
		z_{c}   &= &r\sin(\theta)
			\label{eqn:coord_mapping}
	\end{eqnarray}
\end{subequations}

%\begin{subequations}
%	\begin{eqnarray}	
%		x			&= & x_{c} \\
%		r   		&= & \sqrt{y_{c}^2 + z_{c}^2}\\
%		\theta &= & \arctan(y_{c},z_{c})
%		\label{eqn:coord_mapping2}
%	\end{eqnarray}
%\end{subequations}


	\begin{eqnarray}
		\begin{Bmatrix}
			dx_{c} \\
			dy_{c} \\
			dz_{c}
		\end{Bmatrix}
		 = 
		\begin{pmatrix}
		    1 &  0 &  0 \\
			0 & \cos(\theta) & -r\sin(\theta) \\
			0 & \sin(\theta) & r\cos(\theta)  
		\end{pmatrix}
		\begin{Bmatrix}
			dx \\
			dr \\
			d\theta
		\end{Bmatrix} \\
	\implies
	\begin{Bmatrix}
		dx \\
		dr \\
		d\theta
	\end{Bmatrix}
	= 
	\begin{pmatrix}
		1 &  0 &  0 \\
		0 & \cos(\theta) & \sin(\theta) \\
		0 & -\sin(\theta)/r & \cos(\theta)/r  
	\end{pmatrix}
	\begin{Bmatrix}
	dx_{c} \\
	dy_{c} \\
	dz_{c}
\end{Bmatrix}
	\end{eqnarray}

\begin{subequations}
	\begin{eqnarray}	
		\hat{x}	&= & \hat{x_{c}} \\
		\hat{r}   &= & \cos(\theta)\hat{y_{c}} + \sin(\theta)\hat{z_{c}}\\
		\hat{\theta}   &= & -\sin(\theta)\hat{y_{c}} + \cos(\theta)\hat{z_{c}}
		\label{eqn:unit_vector_mapping}
	\end{eqnarray}
\end{subequations}

\begin{eqnarray}
\implies
	\begin{Bmatrix}
		d\hat{x} \\
		d\hat{r}\\
		d\hat{\theta}
	\end{Bmatrix}
	&=& 
	\begin{pmatrix}
		0 &  0 &  0 \\
		0 & 0 &  -\sin(\theta)\hat{y_{c}} + \cos(\theta)\hat{z_{c}} \\
		0 & 0 & -\cos(\theta)\hat{y_{c}} - \sin(\theta)\hat{z_{c}}  
	\end{pmatrix}
	\begin{Bmatrix}
		dx \\
		dr \\
		d\theta
	\end{Bmatrix} \nonumber \\
%
\implies 	
\begin{Bmatrix}
	d\hat{x} \\
	d\hat{r}\\
	d\hat{\theta}
\end{Bmatrix}
& = &
\begin{pmatrix}
	0 &  0 &  0 \\
	0 & 0 &  \hat{\theta} \\
	0 & 0 & -\hat{r} 
\end{pmatrix}
\begin{Bmatrix}
	dx \\
	dr \\
	d\theta
\end{Bmatrix}
\label{eqn:Jacobian_unit_vector}
\end{eqnarray}

\subsection{Gradient/Divergence/Laplace Operators}

For scalar fields
\begin{eqnarray}
	\begin{split}
	\nabla(\psi) 	= & \left(\frac{\partial\psi}{\partial x}\frac{\partial x}{\partial x_{c}} + \frac{\partial\psi}{\partial r}\frac{\partial r}{\partial x_{c}} + \frac{\partial\psi}{\partial \theta}\frac{\partial \theta}{\partial x_{c}}\right)\hat{x_{c}} + \\
	%
	& \left(\frac{\partial\psi}{\partial x}\frac{\partial x}{\partial y_{c}} + \frac{\partial\psi}{\partial r}\frac{\partial r}{\partial y_{c}} + \frac{\partial\psi}{\partial \theta}\frac{\partial \theta}{\partial y_{c}}\right)\hat{y_{c}} + \\
	%
	& \left(\frac{\partial\psi}{\partial x}\frac{\partial x}{\partial z_{c}} + \frac{\partial\psi}{\partial r}\frac{\partial r}{\partial z_{c}} + \frac{\partial\psi}{\partial \theta}\frac{\partial \theta}{\partial z_{c}} \right)\hat{z_{c}}
	\end{split} \nonumber
\end{eqnarray}

\begin{eqnarray}
	\therefore \nabla(\psi) 	= \frac{\partial\psi}{\partial x}\hat{x} + \frac{\partial\psi}{\partial r}\hat{r} + \frac{1}{r}\frac{\partial\psi}{\partial \theta}\hat{\theta}
	\label{eqn:scalar_gradient}
\end{eqnarray}

Laplacian of a scalar field
\begin{eqnarray}
\nabla\cdot\nabla(\psi) = \left[\frac{\partial}{\partial x}\hat{x} + \frac{\partial}{\partial r}\hat{r} + \frac{1}{r}\frac{\partial}{\partial \theta}\hat{\theta} \right]\cdot\left[\hat{x}\frac{\partial\psi}{\partial x} + \hat{r}\frac{\partial\psi}{\partial r} + \hat{\theta}\frac{1}{r}\frac{\partial\psi}{\partial \theta}\right] \nonumber \\
= \left\{
\begin{split}
	 \left[\hat{x}\cdot\hat{x}\frac{\partial }{\partial x}\frac{\partial \psi}{\partial x} + \frac{\partial \psi}{\partial x}\frac{\partial \hat{x}}{\partial x}\cdot\hat{x} \right] 
	 + \left[\hat{x}\cdot\hat{r} \frac{\partial }{\partial x}\frac{\partial \psi}{\partial r} + \frac{\partial \psi}{\partial r}\frac{\partial \hat{r}}{\partial x}\cdot\hat{x}		\right] 
	 + \left[\hat{x}\cdot\hat{\theta} \frac{\partial }{\partial x}\left(\frac{1}{r}\frac{\partial \psi}{\partial \theta}\right) + \frac{1}{r}\frac{\partial \psi}{\partial \theta}\frac{\partial \hat{\theta}}{\partial x}\cdot\hat{x}		\right] \\
	 %
	 + \left[\hat{r}\cdot\hat{x}\frac{\partial }{\partial r}\frac{\partial \psi}{\partial x} +   \frac{\partial \psi}{\partial x}\frac{\partial \hat{x}}{\partial r}\cdot\hat{r} \right] 
	 +  \left[\hat{r}\cdot\hat{r} \frac{\partial }{\partial r}\frac{\partial \psi}{\partial r} + \frac{\partial \psi}{\partial r}\frac{\partial \hat{r}}{\partial r}\cdot\hat{r}		\right] 
	 + \left[\hat{r}\cdot\hat{\theta} \frac{\partial }{\partial r}\left(\frac{1}{r}\frac{\partial \psi}{\partial \theta}\right) + \frac{1}{r}\frac{\partial \psi}{\partial \theta}\frac{\partial \hat{\theta}}{\partial r}\cdot\hat{r}		\right] \\
	 %
	 + \left[\hat{\theta}\cdot\hat{x}\frac{1}{r}\frac{\partial }{\partial \theta}\frac{\partial \psi}{\partial x} + \frac{1}{r}\frac{\partial \psi}{\partial x}\frac{\partial \hat{x}}{\partial \theta}\cdot\hat{\theta} \right]
	 +  \left[\hat{\theta}\cdot\hat{r}\frac{1}{r}\frac{\partial }{\partial \theta}\frac{\partial \psi}{\partial r} + \frac{1}{r}\frac{\partial \psi}{\partial r}\frac{\partial \hat{r}}{\partial \theta}\cdot\hat{\theta}		\right] \\
	 + \left[\hat{\theta}\cdot\hat{\theta} \frac{1}{r}\frac{\partial }{\partial \theta}\left(\frac{1}{r}\frac{\partial \psi}{\partial \theta}\right) + \frac{1}{r^2}\frac{\partial \psi}{\partial \theta}\frac{\partial \hat{\theta}}{\partial \theta}\cdot\hat{\theta}		\right]
\end{split}\right. \nonumber
\end{eqnarray}
%
\begin{eqnarray}
\therefore \nabla^{2}(\psi) = \frac{\partial^{2}\psi}{\partial x^{2}} +\frac{1}{r}\frac{\partial }{\partial r}\left(r\frac{\partial \psi}{\partial r}	\right) + \frac{1}{r^{2}}\frac{\partial^{2}\psi}{\partial \theta}
	\label{eqn:scalar_laplacian}
\end{eqnarray}


Vector gradient. Highlighted in color are the only terms which are non-zero differentials of unit vectors.
\begin{eqnarray}
	\nabla(\bm{u}) = \left[\hat{x}\frac{\partial}{\partial x} + \hat{r}\frac{\partial}{\partial r} + \hat{\theta}\frac{1}{r}\frac{\partial}{\partial \theta} \right]\left[\hat{x}u_{x} + \hat{r}u_{r} + \hat{\theta}u_{\theta}\right] \nonumber \\
	= \left\{\begin{split}
	\left[\hat{x}\frac{\partial u_{x}}{\partial x} \hat{x} + \hat{x}u_{x}\frac{\partial \hat{x}}{\partial x} \right] 
	+ \left[\hat{x}\frac{\partial u_{r}}{\partial x}\hat{r} + \hat{x}u_{r}\frac{\partial \hat{r}}{\partial x} \right] 
	+ \left[\hat{x}\frac{\partial u_{\theta}}{\partial x}\hat{\theta}	+ \hat{x}u_{\theta}\frac{\partial \hat{\theta}}{\partial x}\right] \\
	%
	+ \left[\hat{r}\frac{\partial u_{x}}{\partial r}\hat{x} + \hat{r}u_{x}\frac{\partial \hat{x}}{\partial r} \right] 
	+ \left[\hat{r}\frac{\partial u_{r}}{\partial r}\hat{r} + \hat{r}u_{r}\frac{\partial \hat{r}}{\partial r} \right] 
	+ \left[\hat{r}\frac{\partial u_{\theta}}{\partial r}\hat{\theta} + \hat{r}u_{\theta}\frac{\partial \hat{\theta}}{\partial r}\right] \\
	%
	+ \left[\hat{\theta}\frac{1}{r}\frac{\partial u_{x}}{\partial \theta}\hat{x} + 	\hat{\theta}\frac{u_{x}}{r}\frac{\partial \hat{x}}{\partial \theta}\right]
	+ \left[\hat{\theta}\frac{1}{r}\frac{\partial u_{r}}{\partial \theta}\hat{r} + 	\hat{\theta}\color{red}{\frac{u_{r}}{r}\frac{\partial \hat{r}}{\partial \theta}} \color{black} \right]
	+ \left[\hat{\theta}\frac{1}{r}\frac{\partial u_{\theta}}{\partial \theta}\hat{\theta} +  \hat{\theta}\color{blue}{\frac{u_{\theta}}{r}\frac{\partial \hat{\theta}}{\partial \theta}} \color{black}\right]
	\end{split}\right.
%	
\end{eqnarray}

\begin{eqnarray}
	\def\arraystretch{2.5}
	\therefore \nabla(\bm{u}) = 
	\begin{bmatrix}
		\hat{x}\dfrac{\partial u_{x}}{\partial x}\hat{x} & \hat{x}\dfrac{\partial u_{r}}{\partial x}\hat{r}   &  \hat{x}\dfrac{\partial u_{\theta}}{\partial x}\hat{\theta} \\
		\hat{r}\dfrac{\partial u_{x}}{\partial r}\hat{x}  & \hat{r}\dfrac{\partial u_{r}}{\partial r}\hat{r}	&   \hat{r}\dfrac{\partial u_{\theta}}{\partial r}\hat{\theta}\\
		\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}\hat{x} & \hat{\theta}\left(\color{blue}{-\dfrac{u_{\theta}}{r}} \color{black} + \dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta} \right)\hat{r} 	& \hat{\theta}\left( \color{red}{\dfrac{u_{r}}{r}} \color{black} +\dfrac{1}{r} \dfrac{\partial u_{\theta}}{\partial \theta} \right)\hat{\theta}
	\end{bmatrix}
\end{eqnarray}

Vector Laplacian:
\begin{eqnarray}
	\nabla\cdot\nabla(\bm{u}) = \def\arraystretch{2.5} \begin{pmatrix}
		\hat{x}\cdot\dfrac{\partial}{\partial x} + \hat{r}\cdot\dfrac{\partial}{\partial r} + \hat{\theta}\cdot\dfrac{1}{r}\dfrac{\partial}{\partial \theta}
	\end{pmatrix}
	\begin{pmatrix}
	 \hat{x}\dfrac{\partial u_{x}}{\partial x}\hat{x} + & \hat{x}\dfrac{\partial u_{r}}{\partial x}\hat{r}  +  & \hat{x}\dfrac{\partial u_{\theta}}{\partial x}\hat{\theta} +\\
	 \hat{r}\dfrac{\partial u_{x}}{\partial r}\hat{x}  + &\hat{r}\dfrac{\partial u_{r}}{\partial r}\hat{r}   +  &\hat{r}\dfrac{\partial u_{\theta}}{\partial r}\hat{\theta} +\\
	 \hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}\hat{x} + &\hat{\theta}\left(-\dfrac{u_{\theta}}{r} \color{black} + \dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta} \right)\hat{r} 	+ &\hat{\theta}\left( \dfrac{u_{r}}{r} +\dfrac{1}{r} \dfrac{\partial u_{\theta}}{\partial \theta} \right)\hat{\theta}
\end{pmatrix} \nonumber 
\end{eqnarray}

First Column
\begin{eqnarray}
		\left(\hat{x}\cdot\dfrac{\partial}{\partial x} + \hat{r}\cdot\dfrac{\partial}{\partial r} + \hat{\theta}\cdot\dfrac{1}{r}\dfrac{\partial}{\partial \theta}\right)
	\left(	\hat{x}\dfrac{\partial u_{x}}{\partial x}  + \hat{r}\dfrac{\partial u_{x}}{\partial r} + \hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}
	\right) \hat{x} \nonumber \\
	%
	\begin{split}
		= & \quad \hat{x}\cdot\left(\hat{x}\dfrac{\partial^{2}u_{x}}{\partial x^{2}} + \dfrac{\partial \hat{x}}{\partial x}\dfrac{\partial u_{x}}{\partial x}\right)\hat{x}  + \hat{x}\cdot\hat{x}\dfrac{\partial u_{x}}{\partial x}\dfrac{\partial \hat{x}}{\partial x}\\
		%
		&+ \hat{x}\cdot\left(\hat{r}\dfrac{\partial }{\partial x}\dfrac{\partial u_{x}}{\partial r} + \dfrac{\partial \hat{r}}{\partial x}\dfrac{\partial u_{x}}{\partial r}\right)\hat{x} + \hat{x}\cdot\hat{r}\dfrac{\partial u_{x}}{\partial r}\dfrac{\partial \hat{x}}{\partial r} \\
		%
		&+ \hat{x}\cdot\left(\hat{\theta}\dfrac{\partial }{\partial x}\left(\frac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}\right) + \dfrac{\partial \hat{\theta}}{\partial x}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}				\right)\hat{x} + \hat{x}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}\dfrac{\partial \hat{x}}{\partial x}\\
		%
		&+ \hat{r}\cdot\left(\hat{x}\dfrac{\partial }{\partial r}\dfrac{\partial u_{x}}{\partial x}	+ \dfrac{\partial \hat{x}}{\partial r}\dfrac{\partial u_{x}}{\partial x}	\right)\hat{x} + \hat{r}\cdot\hat{x}\dfrac{\partial u_{x}}{\partial x}\dfrac{\partial \hat{x}}{\partial r}\\
		%
		&+ \hat{r}\cdot\left(\hat{r}\dfrac{\partial^{2}u_{x}}{\partial r^{2}} + \dfrac{\partial \hat{r}}{\partial r}\dfrac{\partial u_{x}}{\partial r}\right)\hat{x} + \hat{r}\cdot\hat{r}\dfrac{\partial u_{x}}{\partial r}\dfrac{\partial \hat{x}}{\partial r} \\
		%
		&+ \hat{r}\cdot\left(\hat{\theta}\dfrac{\partial }{\partial r}\left(\frac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}\right) + \dfrac{\partial \hat{\theta}}{\partial r}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta} \right)\hat{x} + \hat{r}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}\dfrac{\partial \hat{x}}{\partial r} \\
		%
		&+ \hat{\theta}\cdot\left(\hat{x}\dfrac{1}{r}\dfrac{\partial }{\partial \theta}\dfrac{\partial u_{x}}{\partial x}  + \dfrac{\partial \hat{x}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial x} \right)\hat{x} + \hat{\theta}\cdot\hat{x}\dfrac{\partial u_{x}}{\partial x}\dfrac{1}{r}\dfrac{\partial \hat{x}}{\partial \theta} \\
		%
		&+ \hat{\theta}\cdot\left(	\hat{r}\dfrac{1}{r}\dfrac{\partial}{\partial \theta}\dfrac{\partial u_{x}}{\partial r}	+ \dfrac{\partial \hat{r}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial r} \right)\hat{x} + \hat{\theta}\cdot\hat{r}\dfrac{\partial u_{x}}{\partial r}\dfrac{1}{r}\dfrac{\partial \hat{x}}{\partial \theta} \\
		%
		&+ \hat{\theta}\cdot\left(\hat{\theta}\dfrac{1}{r}\dfrac{\partial }{\partial \theta}\left(\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}\right)\hat{x}
		+ \dfrac{\partial \hat{\theta}}{\partial \theta}\dfrac{1}{r^{2}}\dfrac{\partial u_{x}}{\partial \theta} \right) \hat{x} + \hat{\theta}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{x}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial \hat{x}}{\partial \theta}
	\end{split} \nonumber \\
	= \left[\dfrac{\partial^{2}u_{x}}{\partial x^{2}} + \dfrac{\partial^{2}u_{x}}{\partial r^{2}} + \dfrac{1}{r}\dfrac{\partial u_{x}}{\partial r} + \dfrac{1}{r^{2}}\dfrac{\partial^{2} u_{x}}{\partial \theta^{2}}	\right]\hat{x}
\end{eqnarray}




Second column:
\begin{eqnarray}
		\left(\hat{x}\cdot\dfrac{\partial}{\partial x} + \hat{r}\cdot\dfrac{\partial}{\partial r} + \hat{\theta}\cdot\dfrac{1}{r}\dfrac{\partial}{\partial \theta}\right)
		\left(	\hat{x}\dfrac{\partial u_{r}}{\partial x}  + \hat{r}\dfrac{\partial u_{r}}{\partial r} - \hat{\theta} \dfrac{u_{\theta}}{r} + \hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta}
\right) \hat{r} \nonumber \\
%
	\begin{split}
	= & \quad \hat{x}\cdot\left(\hat{x}\dfrac{\partial^{2}u_{r}}{\partial x^{2}} + \dfrac{\partial \hat{x}}{\partial x}\dfrac{\partial u_{r}}{\partial x} \right)\hat{r} + \hat{x}\cdot\hat{x}\dfrac{\partial u_{r}}{\partial x}\dfrac{\partial \hat{r}}{\partial x} \\
	%
	&+ \hat{x}\cdot\left(\hat{r}\dfrac{\partial }{\partial x}\dfrac{\partial u_{r}}{\partial r} + \dfrac{\partial \hat{r}}{\partial x}\dfrac{\partial u_{r}}{\partial r}\right)\hat{r} + \hat{x}\cdot\hat{r}\dfrac{\partial u_{r}}{\partial r}\dfrac{\partial \hat{r}}{\partial x} \\
	%
	& + \hat{x}\cdot\left( -\hat{\theta}\dfrac{\partial }{\partial x}\dfrac{u_{\theta}}{r}	- \dfrac{\partial \hat{\theta}}{\partial x}\dfrac{u_{\theta}}{r}  \right)\hat{r}   - \hat{x}\cdot\hat{\theta}\dfrac{u_{\theta}}{r}\dfrac{\partial \hat{r}}{\partial x} \\
	%
	&+ \hat{x}\cdot\left(\hat{\theta}\dfrac{\partial }{\partial x}\left(\frac{1}{r}\dfrac{\partial u_{r}}{\partial \theta}\right) + \dfrac{\partial \hat{\theta}}{\partial x}\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta} \right)\hat{r}  + \hat{x}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta}\dfrac{\partial \hat{r}}{\partial x}\\
	%
	&+ \hat{r}\cdot\left(\hat{x}\dfrac{\partial }{\partial r}\dfrac{\partial u_{r}}{\partial x}	+ \dfrac{\partial \hat{x}}{\partial r}\dfrac{\partial u_{r}}{\partial x}	\right)\hat{r} + \hat{r}\cdot\hat{x}\dfrac{\partial u_{r}}{\partial x}\dfrac{\partial \hat{r}}{\partial r} \\
	%
	&+ \hat{r}\cdot\left(\hat{r}\dfrac{\partial^{2}u_{r}}{\partial r^{2}} + \dfrac{\partial \hat{r}}{\partial r}\dfrac{\partial u_{r}}{\partial r}\right)\hat{r} + \hat{r}\cdot\hat{r}\dfrac{\partial u_{r}}{\partial r}\dfrac{\partial \hat{r}}{\partial r}\\
	%
	& + \hat{r}\cdot\left( -\hat{\theta}\dfrac{\partial }{\partial r}\dfrac{u_{\theta}}{r}	- \dfrac{\partial \hat{\theta}}{\partial r}\dfrac{u_{\theta}}{r} \right)\hat{r}  - \hat{r}\cdot\hat{\theta}\dfrac{u_{\theta}}{r}\dfrac{\partial \hat{r}}{\partial r}  \\
	%
	&+ \hat{r}\cdot\left(\hat{\theta}\dfrac{\partial }{\partial r}\left(\frac{1}{r}\dfrac{\partial u_{r}}{\partial \theta}\right) + \dfrac{\partial \hat{\theta}}{\partial r}\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta} \right)\hat{r} + \hat{r}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta}\dfrac{\partial \hat{r}}{\partial r}\\
	%
	&+ \hat{\theta}\cdot\left(\hat{x}\dfrac{1}{r}\dfrac{\partial }{\partial \theta}\dfrac{\partial u_{r}}{\partial x}  + \dfrac{\partial \hat{x}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial x} \right)\hat{r} + \hat{\theta}\cdot\hat{x}\dfrac{\partial u_{r}}{\partial x}\dfrac{1}{r}\dfrac{\partial \hat{r}}{\partial \theta} \\
	%
	&+ \hat{\theta}\cdot\left(	\hat{r}\dfrac{1}{r}\dfrac{\partial}{\partial \theta}\dfrac{\partial u_{r}}{\partial r}	+ \dfrac{\partial \hat{r}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial r} \right)\hat{r} + \hat{\theta}\cdot\hat{r}\dfrac{\partial u_{r}}{\partial r}\dfrac{1}{r}\dfrac{\partial \hat{r}}{\partial \theta} \\
	%
	& + \hat{\theta}\cdot\left( -\hat{\theta}\dfrac{1}{r}\dfrac{\partial }{\partial \theta}\dfrac{u_{\theta}}{r}	- \dfrac{\partial \hat{\theta}}{\partial \theta}\dfrac{1}{r}\dfrac{u_{\theta}}{r}  \right)\hat{r}  - \hat{\theta}\cdot\hat{\theta}\dfrac{u_{\theta}}{r}\dfrac{1}{r}\dfrac{\partial \hat{r}}{\partial \theta} \\
	%
	&+ \hat{\theta}\cdot\left(\hat{\theta}\dfrac{1}{r}\dfrac{\partial }{\partial \theta}\left(\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta}\right)
	+ \dfrac{\partial \hat{\theta}}{\partial \theta}\dfrac{1}{r^{2}}\dfrac{\partial u_{r}}{\partial \theta} \right) \hat{r} + \hat{\theta}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{r}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial \hat{r}}{\partial \theta}
\end{split} \nonumber \\
%
= \left[\dfrac{\partial^{2}u_{r}}{\partial x^{2}} + \dfrac{\partial^{2}u_{r}}{\partial r^{2}} + \dfrac{1}{r}\dfrac{\partial u_{r}}{\partial r} - \dfrac{1}{r^{2}}\dfrac{\partial u_{\theta}}{\partial \theta} +\dfrac{1}{r^{2}}\dfrac{\partial^{2} u_{r}}{\partial \theta^{2}} 	\right]\hat{r}  + \left[- \dfrac{u_{\theta}}{r^{2}} + \dfrac{1}{r^{2}}\dfrac{\partial u_{r}}{\partial \theta}\right]\hat{\theta}
\end{eqnarray}



Third column:
\begin{eqnarray}
		\left(\hat{x}\cdot\dfrac{\partial}{\partial x} + \hat{r}\cdot\dfrac{\partial}{\partial r} + \hat{\theta}\cdot\dfrac{1}{r}\dfrac{\partial}{\partial \theta}\right)
\left(	\hat{x}\dfrac{\partial u_{\theta}}{\partial x}  + \hat{r}\dfrac{\partial u_{\theta}}{\partial r} + \hat{\theta} \dfrac{u_{r}}{r} + \hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta}
\right) \hat{\theta} \nonumber \\
%
\begin{split}
	= & \quad \hat{x}\cdot\left(\hat{x}\dfrac{\partial^{2}u_{\theta}}{\partial x^{2}} + \dfrac{\partial \hat{x}}{\partial x}\dfrac{\partial u_{\theta}}{\partial x} \right)\hat{\theta} + \hat{x}\cdot\hat{x}\dfrac{\partial u_{\theta}}{\partial x}\dfrac{\partial \hat{\theta}}{\partial x} \\
	%
	&+ \hat{x}\cdot\left(\hat{r}\dfrac{\partial }{\partial x}\dfrac{\partial u_{\theta}}{\partial r} + \dfrac{\partial \hat{r}}{\partial x}\dfrac{\partial u_{\theta}}{\partial r}\right)\hat{\theta} + \hat{x}\cdot\hat{r}\dfrac{\partial u_{\theta}}{\partial r}\dfrac{\partial \hat{\theta}}{\partial x} \\
	%
	& + \hat{x}\cdot\left( \hat{\theta}\dfrac{\partial }{\partial x}\dfrac{u_{r}}{r}	+ \dfrac{\partial \hat{\theta}}{\partial x}\dfrac{u_{r}}{r}  \right)\hat{\theta}   + \hat{x}\cdot\hat{\theta}\dfrac{u_{r}}{r}\dfrac{\partial \hat{\theta}}{\partial x} \\
	%
	&+ \hat{x}\cdot\left(\hat{\theta}\dfrac{\partial }{\partial x}\left(\frac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta}\right) + \dfrac{\partial \hat{\theta}}{\partial x}\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta} \right)\hat{\theta} + \hat{x}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta}\dfrac{\partial \hat{\theta}}{\partial x}\\
	%
	&+ \hat{r}\cdot\left(\hat{x}\dfrac{\partial }{\partial r}\dfrac{\partial u_{\theta}}{\partial x} + \dfrac{\partial \hat{x}}{\partial r}\dfrac{\partial u_{\theta}}{\partial x}	\right)\hat{\theta} + \hat{r}\cdot\hat{x}\dfrac{\partial u_{\theta}}{\partial x}\dfrac{\partial \hat{\theta}}{\partial r} \\
	%
	&+ \hat{r}\cdot\left(\hat{r}\dfrac{\partial^{2}u_{\theta}}{\partial r^{2}} + \dfrac{\partial \hat{r}}{\partial r}\dfrac{\partial u_{\theta}}{\partial r}\right)\hat{\theta} + \hat{r}\cdot\hat{r}\dfrac{\partial u_{\theta}}{\partial r}\dfrac{\partial \hat{\theta}}{\partial r}\\
	%
	& + \hat{r}\cdot\left( \hat{\theta}\dfrac{\partial }{\partial r}\dfrac{u_{r}}{r}  + \dfrac{\partial \hat{\theta}}{\partial r}\dfrac{u_{r}}{r} \right)\hat{\theta}  + \hat{r}\cdot\hat{\theta}\dfrac{u_{r}}{r}\dfrac{\partial \hat{\theta}}{\partial r}  \\
	%
	&+ \hat{r}\cdot\left(\hat{\theta}\dfrac{\partial }{\partial r}\left(\frac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta}\right) + \dfrac{\partial \hat{\theta}}{\partial r}\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta} \right)\hat{\theta} + \hat{r}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta}\dfrac{\partial \hat{\theta}}{\partial r}\\
	%
	&+ \hat{\theta}\cdot\left(\hat{x}\dfrac{1}{r}\dfrac{\partial }{\partial \theta}\dfrac{\partial u_{\theta}}{\partial x}  + \dfrac{\partial \hat{x}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial x} \right)\hat{\theta} + \hat{\theta}\cdot\hat{x}\dfrac{\partial u_{\theta}}{\partial x}\dfrac{1}{r}\dfrac{\partial \hat{\theta}}{\partial \theta} \\
	%
	&+ \hat{\theta}\cdot\left(	\hat{r}\dfrac{1}{r}\dfrac{\partial}{\partial \theta}\dfrac{\partial u_{\theta}}{\partial r}	+ \dfrac{\partial \hat{r}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial r} \right)\hat{\theta} + \hat{\theta}\cdot\hat{r}\dfrac{\partial u_{\theta}}{\partial r}\dfrac{1}{r}\dfrac{\partial \hat{\theta}}{\partial \theta} \\
	%
	& + \hat{\theta}\cdot\left( \hat{\theta}\dfrac{1}{r}\dfrac{\partial }{\partial \theta}\dfrac{u_{r}}{r}	+ \dfrac{\partial \hat{\theta}}{\partial \theta}\dfrac{1}{r}\dfrac{u_{r}}{r}  \right)\hat{\theta}  + \hat{\theta}\cdot\hat{\theta}\dfrac{u_{r}}{r}\dfrac{1}{r}\dfrac{\partial \hat{\theta}}{\partial \theta} \\
	%
	&+ \hat{\theta}\cdot\left(\hat{\theta}\dfrac{1}{r}\dfrac{\partial }{\partial \theta}\left(\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta}\right)
	+ \dfrac{\partial \hat{\theta}}{\partial \theta}\dfrac{1}{r^{2}}\dfrac{\partial u_{\theta}}{\partial \theta} \right) \hat{\theta} + \hat{\theta}\cdot\hat{\theta}\dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial \theta}\dfrac{1}{r}\dfrac{\partial \hat{\theta}}{\partial \theta}
\end{split} \nonumber \\
	%
	= \left[\dfrac{\partial^{2}u_{\theta}}{\partial x^{2}} + \dfrac{\partial^{2}u_{\theta}}{\partial r^{2}} + \dfrac{1}{r}\dfrac{\partial u_{\theta}}{\partial r} + \dfrac{1}{r^{2}}\dfrac{\partial u_{r}}{\partial \theta}   + \dfrac{1}{r^{2}}\dfrac{\partial^{2} u_{\theta}}{\partial \theta^{2}}	\right]\hat{\theta}  + \left[- \dfrac{u_{r}}{r^{2}}  - \dfrac{1}{r^{2}}\dfrac{\partial u_{\theta}}{\partial \theta}  \right]\hat{r}
\end{eqnarray}

% Collected vector laplacian quantities.
\begin{eqnarray}
	\therefore \nabla\cdot\nabla (\bm{u}) = \left\{
	\begin{split}
		& \left[\dfrac{\partial^{2}u_{x}}{\partial x^{2}} + \dfrac{1}{r}\dfrac{\partial }{\partial r}\left(r\dfrac{\partial u_{x}}{\partial r}\right) +  \dfrac{1}{r^{2}}\dfrac{\partial^{2} u_{x}}{\partial \theta^{2}}	\right]\hat{x} + \\
		%
		& \left[\dfrac{\partial^{2}u_{r}}{\partial x^{2}} + \dfrac{1}{r}\dfrac{\partial }{\partial r}\left(r\dfrac{\partial u_{r}}{\partial r}\right) +\dfrac{1}{r^{2}}\dfrac{\partial^{2} u_{r}}{\partial \theta^{2}} - \dfrac{u_{r}}{r^{2}} - \dfrac{2}{r^{2}}\dfrac{\partial u_{\theta}}{\partial \theta}  \right]\hat{r}  +\\
		%
		& \left[\dfrac{\partial^{2}u_{\theta}}{\partial x^{2}} + \dfrac{1}{r}\dfrac{\partial }{\partial r}\left(r\dfrac{\partial u_{\theta}}{\partial r}\right) + \dfrac{1}{r^{2}}\dfrac{\partial^{2} u_{\theta}}{\partial \theta^{2}} + \dfrac{2}{r^{2}}\dfrac{\partial u_{r}}{\partial \theta}   - \dfrac{u_{\theta}}{r^{2}} \right]\hat{\theta}  
	\end{split}\right. \label{eqn:vector_laplacian}
\end{eqnarray}

Which can be written using the Laplacian of individual scalar fields, $u_{x},u_{r},u_{\theta}$ as,

\begin{eqnarray}
	\therefore \nabla\cdot\nabla (\bm{u}) = 
\begin{split}
	 \nabla^{2}(u_{x}) \hat{x} + \left(\nabla^{2}(u_{r}) - \dfrac{u_{r}}{r^{2}} - \dfrac{2}{r^{2}}\dfrac{\partial u_{\theta}}{\partial \theta}  \right)\hat{r}  + 
	%
	 \left( \nabla^{2}(u_{\theta}) + \dfrac{2}{r^{2}}\dfrac{\partial u_{r}}{\partial \theta}   - \dfrac{u_{\theta}}{r^{2}} \right)\hat{\theta}  
\end{split} \label{eqn:vector_laplacian_scalar}
\end{eqnarray}

\section{Nek Implementations:}

\subsection{Opgradt}

The opgradt subroutine implements the gradient of a field defined on Mesh 2 (pressure mesh), integrated w.r.t the Mesh 1 test functions.
This is done with integration by parts which creates a boundary term.

Pressure term in the momentum equations:
\begin{eqnarray}
	 - \mathlarger\int_{\Omega} v\dfrac{\partial }{\partial x_{j}}(p\delta_{ij}) d\Omega \nonumber \\
				  -\mathlarger\int_{\Omega} \dfrac{\partial }{\partial x_{j}}(vp\delta_{ij}) d\Omega + \mathlarger\int_{\Omega} p\delta_{ij}\dfrac{\partial }{\partial x_{j}}(v) d\Omega \nonumber \\
				  -\mathlarger\int_{\partial\Omega} (vp\delta_{ij}) n_{j} dA + \mathlarger\int_{\Omega} p\delta_{ij}\dfrac{\partial }{\partial x_{j}}(v) d\Omega \nonumber 
\end{eqnarray}
The first term is the boundary condition. The second term is what opgradt evaluates. I represent the determinant of the mapping between reference element and physical coordinates, the Jacobian as $\mathcal{J}$. In the continuous formulation, this becomes:
\begin{eqnarray}
	w_{i}	=& \mathlarger\int_{\Omega} p\dfrac{\partial v}{\partial x_{i}} d\Omega \nonumber \\
				 =& \mathlarger\int_{\Omega} p\dfrac{\partial v}{\partial x_{i}} \left(\dfrac{\partial \Omega}{\partial \hat{\Omega}}\right) d\hat{\Omega} \nonumber \\
				 =& \mathlarger\int_{\Omega} p\left(\dfrac{1}{\mathcal{J}}\dfrac{\partial r}{\partial x_{i}}\dfrac{\partial v}{\partial r} + \dfrac{1}{\mathcal{J}}\dfrac{\partial s}{\partial x_{i}}\dfrac{\partial v}{\partial s} + \dfrac{1}{\mathcal{J}}\dfrac{\partial t}{\partial x_{i}}\dfrac{\partial v}{\partial t}\right)\mathcal{J} d\hat{\Omega} \nonumber \\
				=& \mathlarger\int_{\Omega} p\left(\dfrac{\partial r}{\partial x_{i}}\dfrac{\partial v}{\partial r} + \dfrac{\partial s}{\partial x_{i}}\dfrac{\partial v}{\partial s} + \dfrac{\partial t}{\partial x_{i}}\dfrac{\partial v}{\partial t}\right) d\hat{\Omega} \nonumber \\
\implies w_{i}	=& \mathlarger\int_{\Omega} p\left(\dfrac{\partial r_{j}}{\partial x_{i}}\dfrac{\partial v}{\partial r_{j}}\right) d\hat{\Omega},
\end{eqnarray}
where, $r_{i}$ represents the reference element coordinate directions $r,s,t$
After discretization, this becomes:
\begin{eqnarray}
	\implies w_{i}	=& \sum_{k} W(x_{k})\left(\dfrac{\partial r_{j}}{\partial x_{i}}\dfrac{\partial v}{\partial r_{j}}(x_{k})\right)p  \nonumber
\end{eqnarray}
In the case of no cross derivative terms like $\partial s/\partial x$ etc., this has a simple tensor product evaluation using:
\begin{subequations}
\begin{eqnarray}
	w_{1}	= (\mathcal{I}^{T}_{z12}\otimes\mathcal{I}^{T}_{y12}\otimes\mathcal{D}^{T}_{x12})(W.*\dfrac{\partial r}{\partial x}.*p) \\
	w_{2}	= (\mathcal{I}^{T}_{z12}\otimes\mathcal{D}^{T}_{y12}\otimes\mathcal{I}^{T}_{x12})(W.*\dfrac{\partial s}{\partial y}.*p) \\
	w_{3}	= (\mathcal{D}^{T}_{z12}\otimes\mathcal{I}^{T}_{y12}\otimes\mathcal{I}^{T}_{x12})(W.*\dfrac{\partial t}{\partial z}.*p)
\end{eqnarray}
\end{subequations}

For the cylindrical case we have
\begin{eqnarray}
	w_{x} =& \mathlarger\int_{\Omega} p\left(\dfrac{\partial r}{\partial x}\dfrac{\partial v}{\partial r} + \dfrac{\partial s}{\partial x}\dfrac{\partial v}{\partial s} + \dfrac{\partial t}{\partial x}\dfrac{\partial v}{\partial t}\right) d\hat{\Omega} \nonumber \\
	w_{R} =& \mathlarger\int_{\Omega} p\left(\dfrac{\partial r}{\partial R}\dfrac{\partial v}{\partial r} + \dfrac{\partial s}{\partial R}\dfrac{\partial v}{\partial s} + \dfrac{\partial t}{\partial R}\dfrac{\partial v}{\partial t}\right) d\hat{\Omega} \nonumber \\
	w_{\theta} =& \mathlarger\int_{\Omega} \dfrac{p}{R}\left(\dfrac{\partial r}{\partial \theta}\dfrac{\partial v}{\partial r} + \dfrac{\partial s}{\partial \theta}\dfrac{\partial v}{\partial s} + \dfrac{\partial t}{\partial \theta}\dfrac{\partial v}{\partial t}\right) d\hat{\Omega} \nonumber
\end{eqnarray}

%\begin{figure}[h]
%	\centering
%	\includegraphics[width=0.75\linewidth]{cylinder_surf}
%	\caption{FSI surface at two different time instants}
%	\label{fig:fsi_surf}
%\end{figure}



\FloatBarrier

\bibliographystyle{elsarticle-harv}
\bibliography{fsi}
%\printbibliography[notcategory=ignore]
\end{document}


